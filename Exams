package com.example.ingridstoen.myapplication;

import android.os.SystemClock;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.HashMap;
import java.util.List;

/**
 * Created by ingridstoen on 02.03.2017.
 */

public class Exams extends LoginProcess {

    private HashMap<String, Date> exams = new HashMap<>();
    private WebDriver driver = new ChromeDriver();

    public Exams(Login login) {
        addExams(login);
    }

    public HashMap<String, Date> getExams() {
        return exams;
    }

    public void addExams(Login login) {
        //STUDWEB
        driver.get("https://idp.feide.no/simplesaml/module.php/feide/login.php?asLen=169&AuthState=_"
                + "d3cf8da4fdb8785ba65151ba2683aca1150fe3bfc2%3Ahttps%3A%2F%2Fidp.feide.no%2Fsimplesaml%"
                + "2Fsaml2%2Fidp%2FSSOService.php%3Fspentityid%3Dhttps%253A%252F%252Ffsweb.no"
                + "%252Fstudentweb%26cookieTime%3D1487768961");
        SystemClock.sleep(5000);

        //Choose NTNU as the institution
        chooseNTNU(driver);

        //innlogging med brukerinput
        login(login.username, login.password, driver);

        //need to choose NTNU as the institution one more time
        chooseNTNUAgain(driver);

        //adds the exam dates to this.exams as <subject code subject name, date>
        List<WebElement> datesAndSubjects = driver.findElements(By.className("infoLinje"));
        for (WebElement element : datesAndSubjects){
            int index = datesAndSubjects.indexOf(element);
            if (index == 0 || index % 3 == 0) {
                try {
                    DateFormat df = new SimpleDateFormat("mm.dd.yyyy");
                    Date date = df.parse(element.getText());
                    String courseCode = datesAndSubjects.get(index + 1).getText();
                    String courseName = datesAndSubjects.get(index + 2).getText();
                    this.exams.put(courseCode + " " + courseName, date);
                }
                catch(ParseException e) {
                    e.printStackTrace();
                }

            }

        }

    }


}
